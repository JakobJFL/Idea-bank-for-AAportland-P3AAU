@using BusinessLogicLib
@using Microsoft.Extensions.Configuration

@inject LoadFromDB _data
@inject IConfiguration _config

<div class="modal fade @ModalClass cursor-de" tabindex="-1" style="display:@ModalDisplay;">
    <div class="modal-dialog modal-dialog-scrollable modal-xl bg-transparent" role="document" style="z-index:1055">
        <div class="modal-content rounded-cos border-0">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">@_idea.ProjectName</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @onclick="() => Close()"></button>
            </div>
            <div class="modal-body bg-light">
                <div class="row g-2">
                    <div class="row g-2">
                        <div class="col-12">
                            <div class="row mx-1">
                                <div class="col">
                                    <h6>Initialer</h6>
                                    <p>@_idea.Initials</p>
                                </div>
                                <div class="col">
                                    <h6>Forretningsenhed</h6>
                                    <p>@_idea.BusinessUnit</p>
                                </div>
                                <div class="col">
                                    <h6>Afdeling</h6>
                                    <p>@_idea.Department</p>
                                </div>
                                <div class="col">
                                    <h6>Prioritet</h6>
                                    <p>@_idea.Priority</p>
                                </div>
                                <div class="col">
                                    <h6>Dato</h6>
                                    <p>@_idea.CreatedAt</p>
                                </div>
                                <div class="col">
                                    <h6>Status</h6>
                                    <p>@_idea.Status</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-2 text-muted"
                                        style="margin-top: -0.5rem;">
                                        Idébeskrivelse
                                    </h5>
                                    <p class="card-text">
                                        @_idea.Description
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-2 text-muted"
                                        style="margin-top: -0.5rem;">
                                        Risiko
                                    </h5>
                                    <p class="card-text">
                                        @_idea.Risk
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-2 text-muted"
                                        style="margin-top: -0.5rem;">
                                        Plan
                                    </h5>
                                    <p class="card-text">
                                        @_idea.Plan
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-2 text-muted"
                                        style="margin-top: -0.5rem;">
                                        Forventet resultat
                                    </h5>
                                    <p class="card-text">
                                        @_idea.ExpectedResults
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title mb-2 text-muted"
                                        style="margin-top: -0.5rem;">
                                        Team
                                    </h5>
                                    <p class="card-text">
                                        @_idea.Team
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-2 my-3 bg-light rounded-cos">
                    <div class="container-fluid">
                        <h3 class="my-2">Kommentarspor</h3>
                        <div class="d-flex flex-row mb-2">
                            <textarea type="text" class="form-control rounded-cos my-1"
                                      id="initials"
                                      placeholder="Skriv din kommentar her"></textarea>
                            <div>
                                <input type="text"
                                       class="form-control mx-2 my-1 rounded-cos" id="initials"
                                       maxlength="4" placeholder="Initialer">
                                <button class="btn btn-primary mx-2 my-1 rounded-cos w-100"
                                        type="button">
                                    Kommenter
                                </button>
                            </div>
                        </div>
                        @if (_idea.Comments != null)
                        {
                            foreach (Comment c in _idea.Comments)
                            {
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item bg-transparent mb-0 pb-0 mt-2">
                                        <h6 class="text-primary mb-0">
                                            @c.Initials <small class="text-muted"
                                                                   style="font-size: 0.8rem;">
                                                @c.CreatedAt
                                            </small>
                                        </h6>
                                        <p>
                                            @c.Message
                                        </p>
                                    </li>
                                </ul>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade @ModalClass cursor-de" style="display: @ModalDisplay;" @onclick="() => Close()"></div>
</div>

@code {
    public Guid Guid = Guid.NewGuid();
    public string ModalDisplay = "none;";
    public string ModalClass = "";
    public BusinessLogicLib.ViewIdea _idea = new();

    public async Task Open(BusinessLogicLib.ViewIdea idea)
    {
        StateHasChanged();
        ModalDisplay = "block;";
        await Task.Delay(150);
        ModalClass = "show";
        _idea = idea;
        _idea.Comments = await _data.LoadComments(_config.GetConnectionString("Default"), _idea.Id);
        StateHasChanged();
    }

    public async Task Close()
    {
        ModalClass = "";
        await Task.Delay(250);
        ModalDisplay = "none;";
        StateHasChanged();
    }
}


